<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>피드백 편집 - 리더십 진단 관리자</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; }
    .nav-item { transition: all 0.3s ease; }
    .nav-item:hover { background-color: rgba(255, 255, 255, 0.1); }
    .nav-item.active { 
      background-color: rgba(255, 255, 255, 0.2);
      border-left: 4px solid #fff;
    }
    
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      .sidebar.mobile-open { transform: translateX(0); }
      .main-content { margin-left: 0 !important; }
      .mobile-overlay {
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }
    }
    
    .card-shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: box-shadow 0.3s ease;
    }
    .card-shadow:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .section-button {
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    .section-button.active {
      border-color: #3B82F6;
      background-color: #3B82F6;
      color: white;
    }
    .section-button:not(.active):hover {
      background-color: #F3F4F6;
      border-color: #9CA3AF;
    }
    
    .fixed-textarea {
      resize: vertical;
      min-height: 100px;
      max-height: 200px;
    }
    
    .log-item {
      border-left: 3px solid #e5e7eb;
      transition: all 0.2s ease;
    }
    .log-item:hover {
      border-left-color: #3b82f6;
      background-color: #f8fafc;
    }
  </style>
</head>
<body class="bg-gray-50">
  
  <!-- Mobile Menu Overlay -->
  <div id="mobileOverlay" class="fixed inset-0 mobile-overlay z-40 hidden md:hidden"></div>
  
  <!-- Navigation Sidebar -->
  <div id="sidebar" class="sidebar fixed inset-y-0 left-0 w-64 bg-gray-800 text-white z-50">
    <div class="p-4 md:p-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-lg md:text-xl font-bold">관리자 대시보드</h1>
          <p class="text-gray-400 text-xs md:text-sm" id="adminWelcome">관리자님 환영합니다</p>
        </div>
        <button id="closeSidebar" class="md:hidden text-white hover:text-gray-300">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
    </div>
    
    <nav class="mt-4 md:mt-8">
      <a href="dashboard.html" class="nav-item flex items-center px-4 md:px-6 py-3 text-gray-300 hover:text-white">
        <i class="fas fa-tachometer-alt mr-3"></i>
        <span class="text-sm md:text-base">대시보드</span>
      </a>
      <a href="participants.html" class="nav-item flex items-center px-4 md:px-6 py-3 text-gray-300 hover:text-white">
        <i class="fas fa-users mr-3"></i>
        <span class="text-sm md:text-base">참여자 관리</span>
      </a>
      <a href="feedback.html" class="nav-item active flex items-center px-4 md:px-6 py-3 text-gray-300 hover:text-white">
        <i class="fas fa-edit mr-3"></i>
        <span class="text-sm md:text-base">피드백 편집</span>
      </a>
      <a href="admin-management.html" class="nav-item flex items-center px-4 md:px-6 py-3 text-gray-300 hover:text-white">
        <i class="fas fa-user-cog mr-3"></i>
        <span class="text-sm md:text-base">관리자 관리</span>
      </a>
      <a href="#" class="nav-item flex items-center px-4 md:px-6 py-3 text-gray-300 hover:text-white" onclick="logout()">
        <i class="fas fa-sign-out-alt mr-3"></i>
        <span class="text-sm md:text-base">로그아웃</span>
      </a>
    </nav>
  </div>

  <!-- Main Content Area -->
  <div class="main-content ml-0 md:ml-64 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
      <div class="px-4 md:px-6 py-3 md:py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <button id="mobileMenuBtn" class="md:hidden mr-3 text-gray-600 hover:text-gray-800">
              <i class="fas fa-bars text-xl"></i>
            </button>
            <h2 class="text-lg md:text-2xl font-semibold text-gray-800">피드백 편집</h2>
          </div>
          <div class="flex items-center space-x-2 md:space-x-4">
            <div class="hidden md:block text-sm text-gray-600" id="currentDateTime"></div>
            <button onclick="resetToDefaults()" class="bg-gray-600 hover:bg-gray-700 text-white px-2 md:px-4 py-1 md:py-2 rounded-lg text-xs md:text-sm">
              <i class="fas fa-undo mr-1"></i>
              <span class="hidden md:inline">기본값</span>
            </button>
            <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-2 md:px-4 py-1 md:py-2 rounded-lg text-xs md:text-sm">
              <i class="fas fa-sign-out-alt mr-1"></i>
              <span class="hidden md:inline">로그아웃</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Content -->
    <div class="p-4 md:p-6">
      
      <!-- Success Message -->
      <div id="successMessage" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4 card-shadow">
        <div class="flex items-center">
          <i class="fas fa-check-circle mr-2"></i>
          <span>피드백이 성공적으로 저장되었습니다!</span>
        </div>
      </div>

      <!-- Introduction -->
      <div class="bg-white rounded-lg shadow-sm p-4 md:p-6 mb-6 card-shadow">
        <h3 class="text-lg font-semibold mb-4">피드백 편집 안내</h3>
        <div class="bg-blue-50 rounded-lg p-4">
          <p class="text-blue-700 text-sm">
            <i class="fas fa-info-circle mr-2"></i>
            여기서 수정한 피드백 내용은 진단 결과 페이지에 실시간으로 반영됩니다. 
            변경사항은 자동으로 저장되며, 모든 새로운 진단 결과에 적용됩니다.
          </p>
        </div>
      </div>

      <!-- Main Section Buttons -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <button onclick="showSection('narcissism')" 
                class="section-button p-4 bg-white rounded-lg shadow-sm text-center active" 
                id="btn-narcissism">
          <i class="fas fa-crown text-2xl text-red-500 mb-2"></i>
          <h3 class="font-semibold text-sm md:text-base">나르시시즘</h3>
        </button>
        
        <button onclick="showSection('machiavellianism')" 
                class="section-button p-4 bg-white rounded-lg shadow-sm text-center" 
                id="btn-machiavellianism">
          <i class="fas fa-chess text-2xl text-orange-500 mb-2"></i>
          <h3 class="font-semibold text-sm md:text-base">마키아벨리즘</h3>
        </button>
        
        <button onclick="showSection('psychopathy')" 
                class="section-button p-4 bg-white rounded-lg shadow-sm text-center" 
                id="btn-psychopathy">
          <i class="fas fa-mask text-2xl text-purple-500 mb-2"></i>
          <h3 class="font-semibold text-sm md:text-base">사이코패시</h3>
        </button>
        
        <button onclick="showSection('leadership')" 
                class="section-button p-4 bg-white rounded-lg shadow-sm text-center" 
                id="btn-leadership">
          <i class="fas fa-chart-line text-2xl text-blue-500 mb-2"></i>
          <h3 class="font-semibold text-sm md:text-base">리더십 해석</h3>
        </button>
      </div>

      <!-- Content Sections -->
      
      <!-- 나르시시즘 섹션 -->
      <div id="section-narcissism" class="content-section bg-white rounded-lg shadow-sm p-6 mb-6">
        <h4 class="text-xl font-semibold mb-6 text-red-600">
          <i class="fas fa-crown mr-2"></i>나르시시즘 피드백 편집
        </h4>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div>
            <h5 class="font-semibold text-green-700 mb-3">강점 요소</h5>
            <textarea id="narcissism_positive" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"
                      placeholder="강한 자신감과 추진력&#10;도전적인 목표 설정&#10;카리스마 있는 리더십"></textarea>
            <button onclick="saveDimensionFeedback('narcissism', 'positive')" 
                    class="mt-2 w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>강점 저장
            </button>
          </div>
          
          <div>
            <h5 class="font-semibold text-red-700 mb-3">위험 요소</h5>
            <textarea id="narcissism_risks" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm"
                      placeholder="팀원의 의견 무시&#10;현실 인식 부족&#10;비판에 대한 과민반응"></textarea>
            <button onclick="saveDimensionFeedback('narcissism', 'risks')" 
                    class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>위험요소 저장
            </button>
          </div>
          
          <div>
            <h5 class="font-semibold text-blue-700 mb-3">개선 요소</h5>
            <textarea id="narcissism_improvement" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                      placeholder="공감 능력 개발하기&#10;팀원의 피드백을 적극적으로 듣기&#10;겸손함 연습하기"></textarea>
            <button onclick="saveDimensionFeedback('narcissism', 'improvement')" 
                    class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>개선요소 저장
            </button>
          </div>
        </div>
      </div>

      <!-- 마키아벨리즘 섹션 -->
      <div id="section-machiavellianism" class="content-section bg-white rounded-lg shadow-sm p-6 mb-6 hidden">
        <h4 class="text-xl font-semibold mb-6 text-orange-600">
          <i class="fas fa-chess mr-2"></i>마키아벨리즘 피드백 편집
        </h4>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div>
            <h5 class="font-semibold text-green-700 mb-3">강점 요소</h5>
            <textarea id="machiavellianism_positive" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"
                      placeholder="전략적 사고 능력&#10;협상력과 설득력&#10;현실적인 판단력"></textarea>
            <button onclick="saveDimensionFeedback('machiavellianism', 'positive')" 
                    class="mt-2 w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>강점 저장
            </button>
          </div>
          
          <div>
            <h5 class="font-semibold text-red-700 mb-3">위험 요소</h5>
            <textarea id="machiavellianism_risks" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm"
                      placeholder="팀원과의 신뢰 관계 손상&#10;단기적 성과에 치중&#10;윤리적 딜레마 발생"></textarea>
            <button onclick="saveDimensionFeedback('machiavellianism', 'risks')" 
                    class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>위험요소 저장
            </button>
          </div>
          
          <div>
            <h5 class="font-semibold text-blue-700 mb-3">개선 요소</h5>
            <textarea id="machiavellianism_improvement" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                      placeholder="투명하고 정직한 커뮤니케이션&#10;윤리적 기준 설정하기&#10;장기적 관계 중시하기"></textarea>
            <button onclick="saveDimensionFeedback('machiavellianism', 'improvement')" 
                    class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>개선요소 저장
            </button>
          </div>
        </div>
      </div>

      <!-- 사이코패시 섹션 -->
      <div id="section-psychopathy" class="content-section bg-white rounded-lg shadow-sm p-6 mb-6 hidden">
        <h4 class="text-xl font-semibold mb-6 text-purple-600">
          <i class="fas fa-mask mr-2"></i>사이코패시 피드백 편집
        </h4>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div>
            <h5 class="font-semibold text-green-700 mb-3">강점 요소</h5>
            <textarea id="psychopathy_positive" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"
                      placeholder="압박 상황에서의 냉정함&#10;빠른 의사결정 능력&#10;스트레스 저항력"></textarea>
            <button onclick="saveDimensionFeedback('psychopathy', 'positive')" 
                    class="mt-2 w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>강점 저장
            </button>
          </div>
          
          <div>
            <h5 class="font-semibold text-red-700 mb-3">위험 요소</h5>
            <textarea id="psychopathy_risks" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm"
                      placeholder="팀원과의 감정적 단절&#10;충동적인 의사결정&#10;윤리적 판단력 부족"></textarea>
            <button onclick="saveDimensionFeedback('psychopathy', 'risks')" 
                    class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>위험요소 저장
            </button>
          </div>
          
          <div>
            <h5 class="font-semibold text-blue-700 mb-3">개선 요소</h5>
            <textarea id="psychopathy_improvement" 
                      class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                      placeholder="공감 능력 개발하기&#10;팀원의 감정 상태 관찰하기&#10;의사결정 전 숙고하기"></textarea>
            <button onclick="saveDimensionFeedback('psychopathy', 'improvement')" 
                    class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>개선요소 저장
            </button>
          </div>
        </div>
      </div>

      <!-- 리더십 해석 가이드 섹션 -->
      <div id="section-leadership" class="content-section bg-white rounded-lg shadow-sm p-6 mb-6 hidden">
        <h4 class="text-xl font-semibold mb-6 text-blue-600">
          <i class="fas fa-chart-line mr-2"></i>리더십 해석 가이드 편집
        </h4>
        
        <div class="space-y-8">
          <!-- 전체 진단 결과 -->
          <div>
            <h5 class="text-lg font-semibold text-gray-800 mb-4">전체 진단 결과</h5>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">매우 낮은 점수 (1.0-2.0)</label>
                <textarea id="overall_very_low" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"
                          placeholder="건강하고 균형잡힌 리더십 성향을 보입니다."></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">낮은 점수 (2.0-3.0)</label>
                <textarea id="overall_low" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                          placeholder="전반적으로 안정적인 리더십 성향입니다."></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">보통 점수 (3.0-4.0)</label>
                <textarea id="overall_moderate" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm"
                          placeholder="일부 영역에서 주의깊은 자기성찰이 필요합니다."></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">높은 점수 (4.0-5.0)</label>
                <textarea id="overall_high" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm"
                          placeholder="즉각적인 개선이 필요한 리더십 성향입니다."></textarea>
              </div>
            </div>
            <button onclick="saveLeadershipGuide('overall')" 
                    class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>전체 진단 결과 저장
            </button>
          </div>

          <!-- 중점 개선 영역 -->
          <div>
            <h5 class="text-lg font-semibold text-gray-800 mb-4">중점 개선 영역</h5>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">나르시시즘 개선</label>
                <textarea id="focus_narcissism" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm"
                          placeholder="겸손함과 공감 능력 개발에 집중하세요."></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">마키아벨리즘 개선</label>
                <textarea id="focus_machiavellianism" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm"
                          placeholder="윤리적 기준과 투명한 소통에 집중하세요."></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">사이코패시 개선</label>
                <textarea id="focus_psychopathy" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"
                          placeholder="감정적 연결과 신중한 판단에 집중하세요."></textarea>
              </div>
            </div>
            <button onclick="saveLeadershipGuide('focus')" 
                    class="mt-4 bg-orange-600 hover:bg-orange-700 text-white py-2 px-6 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>중점 개선 영역 저장
            </button>
          </div>

          <!-- 지속적인 발전을 위한 제언 -->
          <div>
            <h5 class="text-lg font-semibold text-gray-800 mb-4">지속적인 발전을 위한 제언</h5>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">일일 실천사항</label>
                <textarea id="development_daily" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"
                          placeholder="매일 팀원 한 명과 개인적 대화하기&#10;의사결정 전 5분 숙고하기&#10;하루 한 번 자기 성찰 시간 갖기"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">주간 목표</label>
                <textarea id="development_weekly" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                          placeholder="팀원들로부터 피드백 받기&#10;리더십 관련 책 1권 읽기&#10;멘토와 코칭 세션 진행하기"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">장기 발전 계획</label>
                <textarea id="development_longterm" 
                          class="fixed-textarea w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"
                          placeholder="360도 피드백 프로그램 참여&#10;리더십 교육과정 수강&#10;정기적 심리검사 및 성향 점검"></textarea>
              </div>
            </div>
            <button onclick="saveLeadershipGuide('development')" 
                    class="mt-4 bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-lg text-sm">
              <i class="fas fa-save mr-2"></i>발전 제언 저장
            </button>
          </div>
        </div>
      </div>

      <!-- 수정 로그 (최하단) -->
      <div class="bg-white rounded-lg shadow-sm p-4 md:p-6 card-shadow">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">
          <i class="fas fa-history mr-2 text-gray-600"></i>수정 로그
        </h3>
        
        <div id="modificationLogs" class="space-y-2 max-h-60 overflow-y-auto">
          <div class="text-sm text-gray-500 text-center py-4">
            <i class="fas fa-info-circle mr-2"></i>아직 수정 기록이 없습니다.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 전역 변수
    let currentAdmin = null;
    let currentSection = 'narcissism';

    // 페이지 초기화
    document.addEventListener('DOMContentLoaded', function() {
      // 간단한 인증 체크
      checkAuth();
      
      // 기본 설정
      updateDateTime();
      setInterval(updateDateTime, 60000);
      setupMobileMenu();
      loadFeedbackData();
      setupEventListeners();
    });

    // 인증 체크
    function checkAuth() {
      const adminData = localStorage.getItem('currentAdmin');
      if (!adminData) {
        window.location.href = 'index.html';
        return false;
      }
      
      currentAdmin = JSON.parse(adminData);
      document.getElementById('adminWelcome').textContent = `${currentAdmin.name}님 환영합니다`;
      return true;
    }

    // 모바일 메뉴 설정
    function setupMobileMenu() {
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('mobileOverlay');
      const closeSidebar = document.getElementById('closeSidebar');

      mobileMenuBtn.addEventListener('click', function() {
        sidebar.classList.add('mobile-open');
        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      });

      function closeMobileMenu() {
        sidebar.classList.remove('mobile-open');
        overlay.classList.add('hidden');
        document.body.style.overflow = '';
      }

      closeSidebar.addEventListener('click', closeMobileMenu);
      overlay.addEventListener('click', closeMobileMenu);
    }

    // 이벤트 리스너 설정
    function setupEventListeners() {
      // 실시간 미리보기 이벤트
      const textareas = document.querySelectorAll('textarea');
      textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
          markAsChanged(this);
        });
      });
    }

    // 변경사항 표시
    function markAsChanged(element) {
      element.dataset.changed = 'true';
      element.style.borderColor = '#f59e0b';
    }

    // 현재 시간 업데이트
    function updateDateTime() {
      const now = new Date();
      const dateTimeString = now.toLocaleString('ko-KR');
      const element = document.getElementById('currentDateTime');
      if (element) {
        element.textContent = dateTimeString;
      }
    }

    // 섹션 전환
    function showSection(sectionName) {
      currentSection = sectionName;
      
      // 모든 버튼 비활성화
      document.querySelectorAll('.section-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // 현재 버튼 활성화
      document.getElementById(`btn-${sectionName}`).classList.add('active');
      
      // 모든 섹션 숨김
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // 현재 섹션 표시
      document.getElementById(`section-${sectionName}`).classList.remove('hidden');
    }

    // 차원별 피드백 저장
    function saveDimensionFeedback(dimension, type) {
      const customFeedback = JSON.parse(localStorage.getItem('customFeedback') || '{}');
      
      if (!customFeedback[dimension]) {
        customFeedback[dimension] = {};
      }
      
      const textarea = document.getElementById(`${dimension}_${type}`);
      const value = textarea.value.split('\n').filter(item => item.trim());
      
      customFeedback[dimension][type] = value;
      localStorage.setItem('customFeedback', JSON.stringify(customFeedback));
      
      // 변경된 필드 확인
      if (textarea.dataset.changed === 'true') {
        addModificationLog([`${dimension} - ${type}`]);
        textarea.dataset.changed = 'false';
        textarea.style.borderColor = '#d1d5db';
      }
      
      // 성공 메시지 표시
      showSuccessMessage();
    }

    // 리더십 가이드 저장
    function saveLeadershipGuide(category) {
      const customFeedback = JSON.parse(localStorage.getItem('customFeedback') || '{}');
      
      if (!customFeedback.leadership) {
        customFeedback.leadership = {};
      }
      
      const changedFields = [];
      
      if (category === 'overall') {
        const levels = ['very_low', 'low', 'moderate', 'high'];
        levels.forEach(level => {
          const textarea = document.getElementById(`overall_${level}`);
          if (textarea) {
            customFeedback.leadership[`overall_${level}`] = textarea.value;
            if (textarea.dataset.changed === 'true') {
              changedFields.push(`전체진단-${level}`);
              textarea.dataset.changed = 'false';
              textarea.style.borderColor = '#d1d5db';
            }
          }
        });
      } else if (category === 'focus') {
        const dimensions = ['narcissism', 'machiavellianism', 'psychopathy'];
        dimensions.forEach(dim => {
          const textarea = document.getElementById(`focus_${dim}`);
          if (textarea) {
            customFeedback.leadership[`focus_${dim}`] = textarea.value;
            if (textarea.dataset.changed === 'true') {
              changedFields.push(`중점개선-${dim}`);
              textarea.dataset.changed = 'false';
              textarea.style.borderColor = '#d1d5db';
            }
          }
        });
      } else if (category === 'development') {
        const periods = ['daily', 'weekly', 'longterm'];
        periods.forEach(period => {
          const textarea = document.getElementById(`development_${period}`);
          if (textarea) {
            customFeedback.leadership[`development_${period}`] = textarea.value;
            if (textarea.dataset.changed === 'true') {
              changedFields.push(`발전제언-${period}`);
              textarea.dataset.changed = 'false';
              textarea.style.borderColor = '#d1d5db';
            }
          }
        });
      }
      
      localStorage.setItem('customFeedback', JSON.stringify(customFeedback));
      
      // 수정 로그 추가
      if (changedFields.length > 0) {
        addModificationLog(changedFields);
      }
      
      // 성공 메시지 표시
      showSuccessMessage();
    }

    // 피드백 데이터 로드
    function loadFeedbackData() {
      const customFeedback = JSON.parse(localStorage.getItem('customFeedback') || '{}');
      
      if (Object.keys(customFeedback).length === 0) {
        initializeDefaultFeedback();
        return;
      }
      
      // 각 차원별 데이터 로드
      const dimensions = ['narcissism', 'machiavellianism', 'psychopathy'];
      dimensions.forEach(dimension => {
        if (customFeedback[dimension]) {
          const types = ['positive', 'risks', 'improvement'];
          types.forEach(type => {
            const element = document.getElementById(`${dimension}_${type}`);
            if (element && customFeedback[dimension][type]) {
              element.value = customFeedback[dimension][type].join('\n');
            }
          });
        }
      });
      
      // 리더십 가이드 데이터 로드
      if (customFeedback.leadership) {
        Object.keys(customFeedback.leadership).forEach(key => {
          const element = document.getElementById(key);
          if (element) {
            element.value = customFeedback.leadership[key];
          }
        });
      }
    }

    // 기본 피드백 초기화
    function initializeDefaultFeedback() {
      const defaultFeedback = {
        narcissism: {
          positive: ["강한 자신감과 추진력", "도전적인 목표 설정", "카리스마 있는 리더십"],
          risks: ["팀원의 의견 무시", "현실 인식 부족", "비판에 대한 과민반응"],
          improvement: ["공감 능력 개발하기", "팀원의 피드백을 적극적으로 듣기", "겸손함 연습하기"]
        },
        machiavellianism: {
          positive: ["전략적 사고 능력", "협상력과 설득력", "현실적인 판단력"],
          risks: ["팀원과의 신뢰 관계 손상", "단기적 성과에 치중", "윤리적 딜레마 발생"],
          improvement: ["투명하고 정직한 커뮤니케이션", "윤리적 기준 설정하기", "장기적 관계 중시하기"]
        },
        psychopathy: {
          positive: ["압박 상황에서의 냉정함", "빠른 의사결정 능력", "스트레스 저항력"],
          risks: ["팀원과의 감정적 단절", "충동적인 의사결정", "윤리적 판단력 부족"],
          improvement: ["공감 능력 개발하기", "팀원의 감정 상태 관찰하기", "의사결정 전 숙고하기"]
        },
        leadership: {
          overall_very_low: "건강하고 균형잡힌 리더십 성향을 보입니다.",
          overall_low: "전반적으로 안정적인 리더십 성향입니다.",
          overall_moderate: "일부 영역에서 주의깊은 자기성찰이 필요합니다.",
          overall_high: "즉각적인 개선이 필요한 리더십 성향입니다.",
          focus_narcissism: "겸손함과 공감 능력 개발에 집중하세요.",
          focus_machiavellianism: "윤리적 기준과 투명한 소통에 집중하세요.",
          focus_psychopathy: "감정적 연결과 신중한 판단에 집중하세요.",
          development_daily: "매일 팀원 한 명과 개인적 대화하기\n의사결정 전 5분 숙고하기\n하루 한 번 자기 성찰 시간 갖기",
          development_weekly: "팀원들로부터 피드백 받기\n리더십 관련 책 1권 읽기\n멘토와 코칭 세션 진행하기",
          development_longterm: "360도 피드백 프로그램 참여\n리더십 교육과정 수강\n정기적 심리검사 및 성향 점검"
        }
      };
      
      localStorage.setItem('customFeedback', JSON.stringify(defaultFeedback));
      loadFeedbackData();
    }

    // 성공 메시지 표시
    function showSuccessMessage() {
      const successMessage = document.getElementById('successMessage');
      successMessage.classList.remove('hidden');
      setTimeout(() => {
        successMessage.classList.add('hidden');
      }, 3000);
    }

    // 수정 로그 추가
    function addModificationLog(changedFields) {
      const logs = JSON.parse(localStorage.getItem('feedbackModificationLogs') || '[]');
      
      const adminInfo = currentAdmin || { name: '관리자', id: 'admin' };
      
      const logEntry = {
        id: Date.now(),
        adminName: adminInfo.name,
        adminId: adminInfo.id,
        timestamp: new Date().toISOString(),
        changedFields: changedFields,
        action: '피드백 편집'
      };
      
      logs.unshift(logEntry);
      
      // 최대 50개의 로그만 유지
      if (logs.length > 50) {
        logs.splice(50);
      }
      
      localStorage.setItem('feedbackModificationLogs', JSON.stringify(logs));
      loadModificationLogs();
    }

    // 수정 로그 로드
    function loadModificationLogs() {
      const logs = JSON.parse(localStorage.getItem('feedbackModificationLogs') || '[]');
      const container = document.getElementById('modificationLogs');
      
      if (logs.length === 0) {
        container.innerHTML = `
          <div class="text-sm text-gray-500 text-center py-4">
            <i class="fas fa-info-circle mr-2"></i>아직 수정 기록이 없습니다.
          </div>
        `;
        return;
      }
      
      container.innerHTML = '';
      
      logs.forEach(log => {
        const logItem = document.createElement('div');
        logItem.className = 'log-item bg-white border border-gray-200 rounded-lg p-3 mb-2';
        
        const timeAgo = getTimeAgo(new Date(log.timestamp));
        
        logItem.innerHTML = `
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center text-sm">
                <i class="fas fa-user-circle text-gray-400 mr-2"></i>
                <span class="font-medium text-gray-900">${log.adminName}</span>
                <span class="text-gray-500 mx-2">•</span>
                <span class="text-gray-500">${timeAgo}</span>
              </div>
              <div class="mt-1 text-sm text-gray-600">
                <i class="fas fa-edit text-blue-500 mr-1"></i>
                ${log.action}: ${log.changedFields.join(', ')}
              </div>
            </div>
          </div>
        `;
        
        container.appendChild(logItem);
      });
    }

    // 시간 경과 계산
    function getTimeAgo(date) {
      const now = new Date();
      const diffInSeconds = Math.floor((now - date) / 1000);
      
      if (diffInSeconds < 60) {
        return '방금 전';
      } else if (diffInSeconds < 3600) {
        return `${Math.floor(diffInSeconds / 60)}분 전`;
      } else if (diffInSeconds < 86400) {
        return `${Math.floor(diffInSeconds / 3600)}시간 전`;
      } else if (diffInSeconds < 2592000) {
        return `${Math.floor(diffInSeconds / 86400)}일 전`;
      } else {
        return date.toLocaleDateString('ko-KR');
      }
    }

    // 기본값으로 복원
    function resetToDefaults() {
      if (confirm('모든 피드백 내용을 기본값으로 복원하시겠습니까?\n현재 편집 중인 내용이 모두 사라집니다.')) {
        localStorage.removeItem('customFeedback');
        initializeDefaultFeedback();
        
        // 복원 로그 추가
        addModificationLog(['전체 피드백 기본값 복원']);
        
        alert('기본값으로 복원되었습니다.');
      }
    }

    // 로그아웃
    function logout() {
      if (confirm('로그아웃 하시겠습니까?')) {
        localStorage.removeItem('currentAdmin');
        window.location.href = 'index.html';
      }
    }

    // 키보드 단축키
    document.addEventListener('keydown', function(e) {
      // Ctrl+S로 현재 섹션 저장
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        
        if (currentSection === 'leadership') {
          // 리더십 섹션의 경우 전체 저장
          saveLeadershipGuide('overall');
          saveLeadershipGuide('focus');
          saveLeadershipGuide('development');
        } else {
          // 차원별 섹션의 경우 모든 타입 저장
          const types = ['positive', 'risks', 'improvement'];
          types.forEach(type => {
            saveDimensionFeedback(currentSection, type);
          });
        }
      }
    });

    // 페이지 로드 시 수정 로그 로드
    window.addEventListener('load', function() {
      loadModificationLogs();
    });
  </script>
</body>
</html>
